
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Databases Code-Along Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-toggle-chapters/toggle.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="DatabaseIndividualExercises.html" />
    
    
    <link rel="prev" href="DatabasesWarmUp.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../ReplSetup.html">
            
                <a href="../ReplSetup.html">
            
                    
                    Repl.it Setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../FullStackOverview/StudentDesc.html">
            
                <a href="../FullStackOverview/StudentDesc.html">
            
                    
                    L1 - Full-stack Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../TemplateLiterals/StudentDesc.html">
            
                <a href="../TemplateLiterals/StudentDesc.html">
            
                    
                    L2 - Template Literals
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../TemplateLiterals/DriversLicenseCodeAlong.html">
            
                <a href="../TemplateLiterals/DriversLicenseCodeAlong.html">
            
                    
                    Driver's License Code-Along
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../TemplateLiterals/DriversLicenseIndividualExercises.html">
            
                <a href="../TemplateLiterals/DriversLicenseIndividualExercises.html">
            
                    
                    Driver's License Individual Exercises
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../JavaScriptFunctions/StudentDesc.html">
            
                <a href="../JavaScriptFunctions/StudentDesc.html">
            
                    
                    L3 - JavaScript Functions (Callbacks)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../JavaScriptFunctions/CallbacksCodeAlong.html">
            
                <a href="../JavaScriptFunctions/CallbacksCodeAlong.html">
            
                    
                    Callbacks Code-Along
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../JavaScriptFunctions/CallbacksIndividualExercises.html">
            
                <a href="../JavaScriptFunctions/CallbacksIndividualExercises.html">
            
                    
                    Callbacks Individual Exercises
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../JavaScriptFunctions/FileReaderChallenge.html">
            
                <a href="../JavaScriptFunctions/FileReaderChallenge.html">
            
                    
                    File Reader Challenge
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../JavaScriptObjects/StudentDesc.html">
            
                <a href="../JavaScriptObjects/StudentDesc.html">
            
                    
                    L4 - JavaScript Objects / JSON
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../JavaScriptObjects/ObjectsCodeAlong.html">
            
                <a href="../JavaScriptObjects/ObjectsCodeAlong.html">
            
                    
                    Objects Code-Along
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../JavaScriptObjects/ObjectsIndividualExercises.html">
            
                <a href="../JavaScriptObjects/ObjectsIndividualExercises.html">
            
                    
                    Objects Individual Exercises
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../JavaScriptObjects/FoodJsonChallenges.html">
            
                <a href="../JavaScriptObjects/FoodJsonChallenges.html">
            
                    
                    Food JSON Challenges
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../HttpOverview/StudentDesc.html">
            
                <a href="../HttpOverview/StudentDesc.html">
            
                    
                    L5 - HTTP Overview
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../SimpleNodeWebServer/StudentDesc.html">
            
                <a href="../SimpleNodeWebServer/StudentDesc.html">
            
                    
                    L6 - Simple Node Web Server
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../SimpleNodeWebServer/SimpleServerCodeAlong.html">
            
                <a href="../SimpleNodeWebServer/SimpleServerCodeAlong.html">
            
                    
                    Simple Server Code-Along
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../SimpleNodeWebServer/SimpleServerIndividualExercises.html">
            
                <a href="../SimpleNodeWebServer/SimpleServerIndividualExercises.html">
            
                    
                    Simple Server Individual Exercises
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../ExpressProjects/StudentDesc.html">
            
                <a href="../ExpressProjects/StudentDesc.html">
            
                    
                    L7 - Express
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../ExpressProjects/ExpressProjectCodeAlong.html">
            
                <a href="../ExpressProjects/ExpressProjectCodeAlong.html">
            
                    
                    Express Server Code-Along
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../ExpressProjects/ExpressProjectIndividualExercises.html">
            
                <a href="../ExpressProjects/ExpressProjectIndividualExercises.html">
            
                    
                    Express Server Individual Exercises
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../ExpressProjects/ExpressPostChallenge.html">
            
                <a href="../ExpressProjects/ExpressPostChallenge.html">
            
                    
                    Express POST Challenge
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../EjsTemplates/StudentDesc.html">
            
                <a href="../EjsTemplates/StudentDesc.html">
            
                    
                    L8 - Creating Page Templates (EJS)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../EjsTemplates/PeopleListStarterApp.html">
            
                <a href="../EjsTemplates/PeopleListStarterApp.html">
            
                    
                    People List Starter App
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../EjsTemplates/PeopleListEjsCodeAlong.html">
            
                <a href="../EjsTemplates/PeopleListEjsCodeAlong.html">
            
                    
                    People List EJS Code-Along
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../EjsTemplates/PeopleListEjsIndividualExercises.html">
            
                <a href="../EjsTemplates/PeopleListEjsIndividualExercises.html">
            
                    
                    People List EJS Individual Exercises
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="StudentDesc.html">
            
                <a href="StudentDesc.html">
            
                    
                    L9 - Databases (Replit DB)
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="DatabasesWarmUp.html">
            
                <a href="DatabasesWarmUp.html">
            
                    
                    Databases Warm-up
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.11.2" data-path="DatabaseCodeAlong.html">
            
                <a href="DatabaseCodeAlong.html">
            
                    
                    Databases Code-Along
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.3" data-path="DatabaseIndividualExercises.html">
            
                <a href="DatabaseIndividualExercises.html">
            
                    
                    Databases Individual Exercises
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../FullCrudAppReplDb/CrudAppWalkthrough.html">
            
                <a href="../FullCrudAppReplDb/CrudAppWalkthrough.html">
            
                    
                    L10 - Building a CRUD App
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="../FullCrudAppReplDb/CrudAppSetup.html">
            
                <a href="../FullCrudAppReplDb/CrudAppSetup.html">
            
                    
                    Setup
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="../FullCrudAppReplDb/CrudAppCreateGet.html">
            
                <a href="../FullCrudAppReplDb/CrudAppCreateGet.html">
            
                    
                    Create (GET)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="../FullCrudAppReplDb/CrudAppCreatePost.html">
            
                <a href="../FullCrudAppReplDb/CrudAppCreatePost.html">
            
                    
                    Create (POST)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.4" data-path="../FullCrudAppReplDb/CrudAppRead.html">
            
                <a href="../FullCrudAppReplDb/CrudAppRead.html">
            
                    
                    Read
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.5" data-path="../FullCrudAppReplDb/CrudAppReadTable.html">
            
                <a href="../FullCrudAppReplDb/CrudAppReadTable.html">
            
                    
                    Read (Table)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.6" data-path="../FullCrudAppReplDb/CrudAppUpdateGet.html">
            
                <a href="../FullCrudAppReplDb/CrudAppUpdateGet.html">
            
                    
                    Update (GET)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.7" data-path="../FullCrudAppReplDb/CrudAppUpdatePost.html">
            
                <a href="../FullCrudAppReplDb/CrudAppUpdatePost.html">
            
                    
                    Update (POST)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.8" data-path="../FullCrudAppReplDb/CrudAppDelete.html">
            
                <a href="../FullCrudAppReplDb/CrudAppDelete.html">
            
                    
                    Delete
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="../FinalProject/FinalProject.html">
            
                <a href="../FinalProject/FinalProject.html">
            
                    
                    Final Project
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Databases Code-Along</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="video-watchlist-code-along-activity">Video Watchlist Code-Along Activity</h1>
<p>Follow the instructions below to create an Express web app that holds a list of video links. These video links should persist on the server by way of the <a href="https://blog.repl.it/database" target="_blank">Repl.it Database</a>.</p>
<h2 id="getting-started">Getting Started</h2>
<p>First, get a basic Node.js app up and running.</p>
<ol>
<li>Create a new <a href="https://repl.it/new/nodejs" target="_blank">Node.js Repl project</a></li>
<li>Name it &quot;Video Watchlist&quot;</li>
<li>Create a new file named <strong>app.js</strong> in the current directory</li>
<li>For test purposes, add a <code>console.log(&apos;hello&apos;)</code> statement to <strong>app.js</strong> </li>
<li>Create another new file, this one named <strong>.replit</strong></li>
<li>In the <strong>.replit</strong> file, add <code>run = &quot;node app.js&quot;</code></li>
<li>Click the &quot;Run&quot; button to run the program, and make sure it works so far</li>
</ol>
<h2 id="a-basic-expressejs-app">A Basic Express/EJS App</h2>
<p>Next, create a basic web server using Express and EJS.</p>
<h3 id="ejs-page">EJS Page</h3>
<p>In the Repl project, start by creating a new folder named <strong>views</strong>. Then, within that folder, create a new file named <strong>index.ejs</strong>. Open the <strong>index.ejs</strong> file, and add the following code:</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Video Watchlist<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>This is a place to store all the videos you want to watch.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 id="app-code---setup">App Code - Setup</h3>
<p>Now, fill out the basic Express/EJS setup code in the <strong>app.js</strong> file. Start by removing all existing code from the file, then follow the steps below.</p>
<ol>
<li>At the top, create a <code>const express</code> variable set to <code>require(&quot;express&quot;)</code></li>
<li>Next, create a <code>const ejs</code> variable set to <code>require(&quot;ejs&quot;)</code></li>
<li>Under that, create two <code>const</code> variables for <code>hostname</code> and <code>port</code><ul>
<li><code>&quot;0.0.0.0&quot;</code> and <code>8080</code> respectively</li>
</ul>
</li>
<li>Next, initialize an <code>app</code> variable by calling <code>express()</code></li>
<li>Under that, use <code>app.set</code> to set the <code>&quot;view engine&quot;</code> to <code>&quot;ejs&quot;</code></li>
</ol>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>);
<span class="hljs-keyword">const</span> ejs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;ejs&quot;</span>);

<span class="hljs-keyword">const</span> hostname = <span class="hljs-string">&quot;0.0.0.0&quot;</span>;
<span class="hljs-keyword">const</span> port = <span class="hljs-number">8080</span>;

<span class="hljs-keyword">let</span> app = express();
app.set(<span class="hljs-string">&quot;view engine&quot;</span>, <span class="hljs-string">&quot;ejs&quot;</span>);
</code></pre>
<h3 id="app-code---homepage">App Code - Homepage</h3>
<p>Now that the introductory part is complete, it&apos;s time to create a homepage.</p>
<ol>
<li>Define a new function named <code>homePage</code></li>
<li>Give the function two parameters: <code>request</code> and <code>response</code></li>
<li>In the body of the function, call <code>response.render</code> and pass in <code>&quot;index&quot;</code></li>
<li>Under the <code>homePage</code> definition, make some space</li>
<li>Call <code>app.get</code> and pass in <code>&quot;/&quot;</code> and <code>homePage</code><ul>
<li>This makes the <code>homePage</code> function run when the root URL is hit</li>
</ul>
</li>
<li>Under that, define the basic <code>listenCallback</code> function</li>
<li>Finally, call <code>app.listen</code>, passing in <code>port</code>, <code>hostname</code>, and <code>listenCallback</code></li>
</ol>
<p>Run the program, and verify that the <strong>index.ejs</strong> code is properly rendered on the homepage!</p>
<pre><code class="lang-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">homePage</span>(<span class="hljs-params">request, response</span>) </span>{
    response.render(<span class="hljs-string">&quot;index&quot;</span>);
}

app.get(<span class="hljs-string">&quot;/&quot;</span>, homePage);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">listenCallback</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Server Running&quot;</span>);
}

app.listen(port, hostname, listenCallback);
</code></pre>
<h2 id="adding-videos">Adding Videos</h2>
<p>Obviously, there are no videos yet. Before viewing videos, add the ability for the user of the site to add videos to the list.</p>
<h3 id="a-form-in-ejs">A Form in EJS</h3>
<p>First, open the <strong>index.ejs</strong> file, and add a <code>&lt;form&gt;&lt;/form&gt;</code> element under the existing <code>&lt;p&gt;&lt;/p&gt;</code> in the <code>&lt;body&gt;&lt;/body&gt;</code>. It should look like this:</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/add&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Add a new video:<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;link&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;Video Link&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;note&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;Video Note&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
</code></pre>
<p>Notice the following parts of the HTML:</p>
<ul>
<li>The <code>action</code> attribute set to <code>&quot;/add&quot;</code><ul>
<li>It will be necessary to create this endpoint in the <strong>app.js</strong> code</li>
</ul>
</li>
<li>The <code>name</code> attributes on the <code>&lt;input&gt;</code> elements<ul>
<li>These will correspond to the video data in the database</li>
</ul>
</li>
</ul>
<p>Run the program again, and verify that the form appears on the homepage. Nothing should happen on submit yet... that comes later.</p>
<h3 id="more-setup">More Setup</h3>
<p>To prepare the code to handle someone submitting the form, start with a few more setup steps. Open up the <strong>app.js</strong> file, and follow the steps in the top section.</p>
<ol>
<li>Create a <code>const url</code> variable set to <code>require(&quot;url&quot;)</code><ul>
<li>This module will be used to parse form results</li>
</ul>
</li>
<li>Create a <code>const uuid</code> variable set to <code>require(&quot;uuid&quot;)</code><ul>
<li>This module will be used to generate unique IDs</li>
</ul>
</li>
<li>Create a <code>const Database</code> variable set to <code>require(&quot;@replit/database&quot;)</code><ul>
<li>This module will allow the code to connect to the Repl.it database</li>
</ul>
</li>
<li>Create a new variable named <code>db</code> and set it to <code>new Database()</code><ul>
<li>The <code>db</code> variable will be the connection!</li>
</ul>
</li>
</ol>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> url = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;url&quot;</span>);
<span class="hljs-keyword">const</span> uuid = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;uuid&quot;</span>);
<span class="hljs-keyword">const</span> Database = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@replit/database&quot;</span>);

<span class="hljs-keyword">let</span> db = <span class="hljs-keyword">new</span> Database();
</code></pre>
<h3 id="the-add-endpoint">The <code>/add</code> Endpoint</h3>
<p>Now that the database exists, it&apos;s time to add some stuff to it. Every time a user submits the form, it should take that data, generate a unique ID for it, and create a new video object in the database.</p>
<blockquote>
<p>Note: Using an HTTP <code>GET</code> request to add data is kind of cheating - it should be a <code>POST</code> request, but <code>GET</code> is a little easier to use for now</p>
</blockquote>
<h4 id="the-addvideo-function---basics">The <code>addVideo</code> Function - Basics</h4>
<ol>
<li>Under the <code>homePage</code> function definition, create some space</li>
<li>Define a new function named <code>addVideo</code></li>
<li>Give the <code>addVideo</code> function two parameters: <code>request</code> and <code>response</code></li>
<li>Make the <code>addVideo</code> function asynchronous by adding <code>async</code> in front of the <code>function</code> keyword</li>
</ol>
<h4 id="the-addvideo-function---body">The <code>addVideo</code> Function - Body</h4>
<ol>
<li>In the body of the <code>addVideo</code> function, create a variable named <code>parsedUrl</code></li>
<li>Set <code>parsedUrl</code> to <code>url.parse(request.url, true)</code><ul>
<li>This contains the data from the form</li>
</ul>
</li>
<li>Under that, create a new variable named <code>newKey</code></li>
<li>Set <code>newKey</code> to <code>&quot;video_&quot; + uuid.v4()</code><ul>
<li>This will create a new unique ID prefixed with <code>video_</code></li>
</ul>
</li>
<li>Next, call the <code>db.set</code> function</li>
<li>Pass in <code>newKey</code> for the first argument<ul>
<li>This is the unique key for the created movie object</li>
</ul>
</li>
<li>Pass in <code>parsedUrl.query</code> for the second argument<ul>
<li>This contains all the data from the form: <code>link</code> and <code>note</code></li>
</ul>
</li>
<li>Add the <code>await</code> keyword in front of the <code>db.set</code> call<ul>
<li>This makes sure the function will not return until the value has been set</li>
</ul>
</li>
<li>Finally, call <code>response.redirect</code> and pass in <code>&quot;/&quot;</code></li>
</ol>
<h4 id="hooking-up-the-addvideo-function">Hooking Up the <code>addVideo</code> Function</h4>
<ol>
<li>Under the <code>addVideo</code> definition, call <code>app.get</code></li>
<li>Pass in <code>&quot;/add&quot;</code> as the first argument</li>
<li>Pass in <code>addVideo</code> as the second argument</li>
</ol>
<p>Now, it should actually be possible to add some data to the database! Run the program, and verify that no errors occur when submitting the form. Go to YouTube to find some video links. For testing purposes, it may be beneficial to use <code>console.log</code> in the body of the <code>addVideo</code> function, to make sure the code is running properly.</p>
<pre><code class="lang-js"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addVideo</span>(<span class="hljs-params">request, response</span>) </span>{
    <span class="hljs-keyword">let</span> parsedUrl = url.parse(request.url, <span class="hljs-literal">true</span>);
    <span class="hljs-keyword">let</span> newKey = <span class="hljs-string">&quot;video_&quot;</span> + uuid.v4();
    <span class="hljs-keyword">await</span> db.set(newKey, parsedUrl.query);

    response.redirect(<span class="hljs-string">&quot;/&quot;</span>);
}

app.get(<span class="hljs-string">&quot;/add&quot;</span>, addVideo);
</code></pre>
<h2 id="viewing-videos">Viewing Videos</h2>
<p>Now there may be some videos in the database, but what good are they if no one can see them? Update the homepage so that it displays the list of videos.</p>
<h3 id="defining-the-getvideos-function">Defining the <code>getVideos</code> Function</h3>
<p>First, define a function to retrieve data from the database, and put it in a nice manageable format.</p>
<ol>
<li>Above the <code>homePage</code> function, define a new function named <code>getVideos</code></li>
<li>Make the <code>getVideos</code> function <code>async</code></li>
<li>In the body of the function, create a new variable named <code>allVideoKeys</code></li>
<li>Use <code>db.list</code> to get all keys prefixed with <code>&quot;video_&quot;</code><ul>
<li>This will retrieve all the video objects added through <code>addVideo</code></li>
</ul>
</li>
<li>Add an <code>await</code> before <code>db.list</code> so that the code does not continue until the keys are retrieved</li>
<li>Under that, create a new empty list variable named <code>allVideos</code><ul>
<li>This will store the nicely formed video objects</li>
</ul>
</li>
<li>Create a <code>for</code> loop structure looping through <code>allVideoKeys</code></li>
<li>In the body of the <code>for</code> loop, get the current key as <code>currentKey</code></li>
<li>Retrieve the <em>value</em> for the current key using <code>await db.get</code><ul>
<li>Store that in a variable named <code>video</code></li>
</ul>
</li>
<li>Set the <code>&quot;id&quot;</code> property of the <code>video</code> object to <code>currentKey</code><ul>
<li>This will come in handy later</li>
</ul>
</li>
<li><code>push</code> the <code>video</code> object to the <code>allVideos</code> list</li>
<li>Outside of the <code>for</code> loop, return the <code>allVideos</code> list</li>
</ol>
<p>Now, the <code>getVideos</code> should properly retrieve every video in the database! Next up, it&apos;s time to <em>use</em> the function.</p>
<pre><code class="lang-js"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getVideos</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">let</span> allVideoKeys = <span class="hljs-keyword">await</span> db.list(<span class="hljs-string">&quot;video_&quot;</span>);
    <span class="hljs-keyword">let</span> allVideos = [];

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; allVideoKeys.length; i++) {
        <span class="hljs-keyword">let</span> currentKey = allVideoKeys[i];
        <span class="hljs-keyword">let</span> video = <span class="hljs-keyword">await</span> db.get(currentKey);
        video[<span class="hljs-string">&quot;id&quot;</span>] = currentKey;

        allVideos.push(video);
    }

    <span class="hljs-keyword">return</span> allVideos;
}
</code></pre>
<h3 id="updating-the-homepage-function">Updating the <code>homePage</code> Function</h3>
<p>The <code>homePage</code> function should send along some data to the <code>&quot;index&quot;</code> template. This data should be retrieved using the <code>getVideos</code> function!</p>
<ol>
<li>Find the the <code>homePage</code> function definition</li>
<li>Make the <code>homePage</code> function <code>async</code><ul>
<li>This is necessary because it will need to <code>await</code> the <code>getVideos</code> function</li>
</ul>
</li>
<li>At the top of the body of the function, create a variable named <code>allVideos</code></li>
<li>Set <code>allVideos</code> to <code>await getVideos()</code></li>
<li>Create a new object named <code>renderData</code></li>
<li>Set the <code>videos</code> property of <code>renderData</code> to be <code>allVideos</code></li>
<li>Pass in <code>renderData</code> to the call to <code>response.render</code></li>
</ol>
<p>Now, the <strong>index.ejs</strong> template should have access to all the video data!</p>
<pre><code class="lang-js"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">homePage</span>(<span class="hljs-params">request, response</span>) </span>{
    <span class="hljs-keyword">let</span> allVideos = <span class="hljs-keyword">await</span> getVideos();

    <span class="hljs-keyword">let</span> renderData = {
        videos: allVideos
    };

    response.render(<span class="hljs-string">&quot;index&quot;</span>, renderData);
}
</code></pre>
<h3 id="updating-the-indexejs-template">Updating the index.ejs Template</h3>
<p>All that&apos;s left is to update the <strong>index.ejs</strong> file so that it can handle the new data it has been given. Open it up and follow the steps below.</p>
<ol>
<li>Make some space above the <code>&lt;form&gt;&lt;/form&gt;</code> element in the HTML <code>body</code></li>
<li>Create a <code>&lt;ul&gt;&lt;/ul&gt;</code> element</li>
<li>Between the <code>ul</code> tags, create a <code>for</code> loop structure with EJS<ul>
<li>This should loop through the <code>videos</code> list</li>
<li>Make sure to add the <code>{</code> and <code>}</code></li>
</ul>
</li>
<li>In the body of the <code>for</code> loop, create an <code>li</code> element</li>
<li>In the body of the <code>li</code> element, create an <code>a</code> element</li>
<li>Set the <code>href</code> of the <code>a</code> to point to the current video link<ul>
<li><code>&lt;%= videos[i].link %&gt;</code></li>
</ul>
</li>
<li>Set the content of the <code>a</code> to be the current video note<ul>
<li><code>&lt;%= videos[i].note %&gt;</code></li>
</ul>
</li>
<li>Under the <code>&lt;/ul&gt;</code>, create an <code>if</code> statement structure</li>
<li>For the <code>if</code> condition, check if the <code>videos</code> list is empty</li>
<li>In the body of the <code>if</code>, add a <code>p</code> saying no videos have been added</li>
</ol>
<p>Run the program, and verify that some videos appear! Try adding a few more, and making sure the page updates automatically to view them. This web server is successfully storing data and surfacing it!</p>
<pre><code class="lang-html">    &lt;ul&gt;
    &lt;% for (let i = 0; i &lt; videos.length; i++) { %&gt;
        &lt;li&gt;
            &lt;a href=&quot;&lt;%= videos[i].link %&gt;&quot;&gt;&lt;%= videos[i].note %&gt;&lt;/a&gt;
        &lt;/li&gt;
    &lt;% } %&gt;
    &lt;/ul&gt;
&lt;% if (videos.length &lt; 1) { %&gt;
    &lt;p&gt;No videos have been added to the list &#x1F614;&lt;/p&gt;
&lt;% } %&gt;
</code></pre>
<h2 id="removing-videos">Removing Videos</h2>
<p>Now, to make the video watchlist functional, add the ability to remove videos. That way, if a user watches a video on their watchlist, they can actually remove it from the list.</p>
<h3 id="the-deleteid-endpoint-in-javascript">The <code>/delete/:id</code> Endpoint in JavaScript</h3>
<p>Start by working in the <strong>app.js</strong> file to create a <code>/delete/:id</code> endpoint.</p>
<ol>
<li>Under the <code>addVideo</code> function, define a new function named <code>deleteVideo</code></li>
<li>Make the function <code>async</code></li>
<li>Give the function two parameters: <code>request</code> and <code>response</code></li>
<li>Outside the function, nder the other <code>app.get</code> calls, create another one</li>
<li>Pass in <code>/delete/:id</code> and <code>deleteVideo</code><ul>
<li>This will call the <code>deleteVideo</code> function whenever the user goes to <code>/delete/&lt;some id&gt;</code></li>
</ul>
</li>
<li>In the body of the <code>deleteVideo</code> function, create a variable named <code>videoId</code></li>
<li>Set <code>videoId</code> to be <code>request.params.id</code><ul>
<li>This will be whatever comes after the slash; the <code>:id</code> in <code>/delete/:id</code></li>
</ul>
</li>
<li>Call <code>db.delete</code>, passing in the <code>videoId</code> variable</li>
<li>Add the <code>await</code> keyword in front of <code>db.delete</code></li>
<li>Use <code>response.redirect</code> to send the user back to the root: <code>&quot;/&quot;</code></li>
</ol>
<p>Try going to a <code>/delete/</code> url with a valid <code>id</code> appended on the end. The object should disappear from the list!</p>
<pre><code class="lang-js"><span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deleteVideo</span>(<span class="hljs-params">request, response</span>) </span>{
    <span class="hljs-keyword">let</span> videoId = request.params.id;
    <span class="hljs-keyword">await</span> db.delete(videoId);

    response.redirect(<span class="hljs-string">&quot;/&quot;</span>);
}


app.get(<span class="hljs-string">&apos;/delete/:id&apos;</span>, deleteVideo);
</code></pre>
<h3 id="adding-a-delete-link-in-ejs">Adding a Delete Link in EJS</h3>
<p>Now it is possible to directly delete data, but it would be nice if there were a way to do it without having to copy and paste a URL. Follow the instructions below to create a delete link that will appear next to each video. Open the <strong>index.ejs</strong> file to get started.</p>
<h4 id="styling">Styling</h4>
<p>First, for simplicity, copy the following code into the above the <code>&lt;html&gt;&lt;/html&gt;</code> element, above the <code>&lt;body&gt;</code>:</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.del</span> {
            <span class="hljs-attribute">color</span>: pink;
            <span class="hljs-attribute">text-decoration</span>: none;
        }

        <span class="hljs-selector-tag">a</span><span class="hljs-selector-class">.del</span><span class="hljs-selector-pseudo">:hover</span> {
            <span class="hljs-attribute">color</span>: red;
        }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
</code></pre>
<p>This will make things look a little nicer.</p>
<h4 id="adding-the-link">Adding the Link</h4>
<p>Next, add the actual link. For a given video, the link should go to <code>/delete/</code> with the video&apos;s <code>id</code> tacked onto the end.</p>
<ol>
<li>Find the <code>a</code> within the <code>li</code> in the <code>for</code> loop</li>
<li>Under that, create another <code>a</code> element</li>
<li>Add a <code>class</code> attribute of <code>del</code> (for styling purposes)</li>
<li>In the content for the <code>a</code>, paste in this times character: <code>&#x2715;</code></li>
<li>Create an <code>href</code> attribute on the <code>a</code></li>
<li>Set it to <code>&quot;/delete/&quot;</code></li>
<li>After the slash, add EJS code to get the <code>id</code> of the current video<ul>
<li><code>&lt;%= videos[i].id %&gt;</code></li>
</ul>
</li>
</ol>
<p>Run the code again, and verify that a little &quot;X&quot; appears next to all the videos! Clicking the &quot;X&quot; should make the video disappear.</p>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;del&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/delete/&lt;%= videos[i].id %&gt;&quot;</span>&gt;</span>&#x2715;<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</code></pre>
<p>The video watchlist is fully functional!</p>
<h2 id="final-code">Final Code</h2>
<p><strong>views/index.ejs</strong></p>
<pre><code class="lang-html">&lt;html&gt;
    &lt;head&gt;
        &lt;style&gt;
            a.del {
                color: pink;
                text-decoration: none;
            }

            a.del:hover {
                color: red;
            }
        &lt;/style&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Video Watchlist&lt;/h1&gt;
        &lt;p&gt;This is a place to store all the videos you want to watch.&lt;/p&gt;
        &lt;ul&gt;
        &lt;% for (let i = 0; i &lt; videos.length; i++) { %&gt;
            &lt;li&gt;
                &lt;a href=&quot;&lt;%= videos[i].link %&gt;&quot;&gt;&lt;%= videos[i].note %&gt;&lt;/a&gt;
                &lt;a class=&quot;del&quot; href=&quot;/delete/&lt;%= videos[i].id %&gt;&quot;&gt;&#x2715;&lt;/a&gt;
            &lt;/li&gt;
        &lt;% } %&gt;
        &lt;/ul&gt;
    &lt;% if (videos.length &lt; 1) { %&gt;
        &lt;p&gt;No videos have been added to the list &#x1F614;&lt;/p&gt;
    &lt;% } %&gt;
        &lt;form action=&quot;/add&quot;&gt;
            &lt;p&gt;Add a new video:&lt;/p&gt;
            &lt;input type=&quot;text&quot; name=&quot;link&quot; placeholder=&quot;Video Link&quot;&gt;
            &lt;input type=&quot;text&quot; name=&quot;note&quot; placeholder=&quot;Video Note&quot;&gt;
            &lt;input type=&quot;submit&quot;&gt;
        &lt;/form&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p><strong>app.js</strong></p>
<pre><code class="lang-js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;express&quot;</span>);
<span class="hljs-keyword">const</span> ejs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;ejs&quot;</span>);
<span class="hljs-keyword">const</span> url = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;url&quot;</span>);
<span class="hljs-keyword">const</span> uuid = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;uuid&quot;</span>);
<span class="hljs-keyword">const</span> Database = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;@replit/database&quot;</span>);

<span class="hljs-keyword">const</span> hostname = <span class="hljs-string">&quot;0.0.0.0&quot;</span>;
<span class="hljs-keyword">const</span> port = <span class="hljs-number">8080</span>;

<span class="hljs-keyword">let</span> db = <span class="hljs-keyword">new</span> Database();
<span class="hljs-keyword">let</span> app = express();

app.set(<span class="hljs-string">&quot;view engine&quot;</span>, <span class="hljs-string">&quot;ejs&quot;</span>);

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getVideos</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">let</span> allVideoKeys = <span class="hljs-keyword">await</span> db.list(<span class="hljs-string">&quot;video_&quot;</span>);
    <span class="hljs-keyword">let</span> allVideos = [];

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; allVideoKeys.length; i++) {
        <span class="hljs-keyword">let</span> currentKey = allVideoKeys[i];
        <span class="hljs-keyword">let</span> video = <span class="hljs-keyword">await</span> db.get(currentKey);
        video[<span class="hljs-string">&quot;id&quot;</span>] = currentKey;

        allVideos.push(video);
    }

    <span class="hljs-keyword">return</span> allVideos;
}

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">homePage</span>(<span class="hljs-params">request, response</span>) </span>{
    <span class="hljs-keyword">let</span> allVideos = <span class="hljs-keyword">await</span> getVideos();

    <span class="hljs-keyword">let</span> renderData = {
        videos: allVideos
    };

    response.render(<span class="hljs-string">&quot;index&quot;</span>, renderData);
}

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addVideo</span>(<span class="hljs-params">request, response</span>) </span>{
    <span class="hljs-keyword">let</span> parsedUrl = url.parse(request.url, <span class="hljs-literal">true</span>);
    <span class="hljs-keyword">let</span> newKey = <span class="hljs-string">&quot;video_&quot;</span> + uuid.v4();
    <span class="hljs-keyword">await</span> db.set(newKey, parsedUrl.query);

    response.redirect(<span class="hljs-string">&quot;/&quot;</span>);
}

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deleteVideo</span>(<span class="hljs-params">request, response</span>) </span>{
    <span class="hljs-keyword">let</span> videoId = request.params.id;
    <span class="hljs-keyword">await</span> db.delete(videoId);

    response.redirect(<span class="hljs-string">&quot;/&quot;</span>);
}

app.get(<span class="hljs-string">&quot;/&quot;</span>, homePage);
app.get(<span class="hljs-string">&quot;/add&quot;</span>, addVideo);
app.get(<span class="hljs-string">&apos;/delete/:id&apos;</span>, deleteVideo);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">listenCallback</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Server Running&quot;</span>);
}

app.listen(port, hostname, listenCallback);
</code></pre>
<h2 id="individual-exercises">Individual Exercises</h2>
<p>After the code-along project is complete, go to <a href="DatabaseIndividualExercises.html">this page</a> to work on some individual exercises.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="DatabasesWarmUp.html" class="navigation navigation-prev " aria-label="Previous page: Databases Warm-up">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="DatabaseIndividualExercises.html" class="navigation navigation-next " aria-label="Next page: Databases Individual Exercises">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Databases Code-Along","level":"1.11.2","depth":2,"next":{"title":"Databases Individual Exercises","level":"1.11.3","depth":2,"path":"DatabasesReplit/DatabaseIndividualExercises.md","ref":"DatabasesReplit/DatabaseIndividualExercises.md","articles":[]},"previous":{"title":"Databases Warm-up","level":"1.11.1","depth":2,"path":"DatabasesReplit/DatabasesWarmUp.md","ref":"DatabasesReplit/DatabasesWarmUp.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["toggle-chapters"],"pluginsConfig":{"toggle-chapters":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"BOOKREADME.md","glossary":"GLOSSARY.md","summary":"COMPLETESUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"DatabasesReplit/DatabaseCodeAlong.md","mtime":"2022-06-24T14:14:03.983Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-06-24T14:14:35.049Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-toggle-chapters/toggle.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

